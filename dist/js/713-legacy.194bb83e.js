"use strict";(self["webpackChunkforum_front_end_vue"]=self["webpackChunkforum_front_end_vue"]||[]).push([[713],{49077:function(t,e,r){r.d(e,{Z:function(){return c}});var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"mb-3"},[r("h1",[t._v("餐廳後台")]),r("router-link",{attrs:{to:"/admin/restaurants"}},[t._v("Restaurants")]),t._v(" | "),r("router-link",{attrs:{to:"/admin/categories"}},[t._v("Categories")]),t._v(" | "),r("router-link",{attrs:{to:"/admin/users"}},[t._v("Users")])],1)},a=[],s=r(1001),i={},o=(0,s.Z)(i,n,a,!1,null,null,null),c=o.exports},57713:function(t,e,r){r.r(e),r.d(e,{default:function(){return p}});var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container py-5"},[r("AdminNav"),r("table",{staticClass:"table"},[t._m(0),r("tbody",t._l(t.users,(function(e){return r("tr",{key:e.id},[r("th",{attrs:{scope:"row"}},[t._v(" "+t._s(e.id)+" ")]),r("td",[t._v(t._s(e.email))]),r("td",[t._v(t._s(t._f("isAdmin")(e.isAdmin)))]),e.id!==t.currentUser.id?r("td",[e.isAdmin?r("button",{staticClass:"btn btn-link",attrs:{disabled:t.isProcessing,type:"button"},on:{click:function(r){return r.preventDefault(),r.stopPropagation(),t.toggleUserRole(e.id)}}},[t._v(" set as user ")]):r("button",{staticClass:"btn btn-link",attrs:{disabled:t.isProcessing,type:"button"},on:{click:function(r){return r.preventDefault(),r.stopPropagation(),t.toggleUserRole(e.id)}}},[t._v(" set as admin ")])]):t._e()])})),0)])],1)},a=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",{staticClass:"thead-dark"},[r("tr",[r("th",{attrs:{scope:"col"}},[t._v(" # ")]),r("th",{attrs:{scope:"col"}},[t._v(" Email ")]),r("th",{attrs:{scope:"col"}},[t._v(" Role ")]),r("th",{attrs:{scope:"col",width:"140"}},[t._v(" Action ")])])])}],s=r(4367),i=r(67906),o=r(16198),c=(r(41539),r(54747),r(39714),r(21703),r(21249),r(49077)),u=r(34665),d=r(19032),l=r(41926),f={components:{AdminNav:c.Z},data:function(){return{users:[],isProcessing:!1}},methods:{fetchUsers:function(){var t=this;return(0,o.Z)((0,i.Z)().mark((function e(){var r,n;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.Z.users.get();case 3:r=e.sent,n=r.data,t.users=n.users,e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("error",e.t0),l.F.fire({icon:"error",title:"無法取得使用者資料，請稍後再試"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},toggleUserRole:function(t){var e=this;return(0,o.Z)((0,i.Z)().mark((function r(){var n,a,o;return(0,i.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,e.isProcessing=!0,n=!1,e.users.forEach((function(e){e.id===t&&(n=!e.isAdmin)})),console.log("isAdmin",n),n=n.toString(),console.log("isAdmin",n),r.next=9,d.Z.users.update({userId:t,isAdmin:n});case 9:if(a=r.sent,o=a.data,"success"===o.status){r.next=13;break}throw new Error(o.message);case 13:e.users=e.users.map((function(e){return e.id===t?(0,s.Z)((0,s.Z)({},e),{},{isAdmin:!e.isAdmin}):e})),e.isProcessing=!1,r.next=22;break;case 17:r.prev=17,r.t0=r["catch"](0),e.isProcessing=!1,console.log("error",r.t0),l.F.fire({icon:"error",title:"無法更新使用者角色，請稍後再試"});case 22:case"end":return r.stop()}}),r,null,[[0,17]])})))()}},computed:(0,s.Z)({},(0,u.rn)(["currentUser"])),created:function(){this.fetchUsers()},filters:{isAdmin:function(t){return t?"Admin":"User"}}},h=f,m=r(1001),v=(0,m.Z)(h,n,a,!1,null,null,null),p=v.exports},19032:function(t,e,r){var n=r(41926),a=function(){return localStorage.getItem("token")};e["Z"]={catagories:{get:function(){return n.l.get("/admin/categories",{headers:{Authorization:"Bearer ".concat(a())}})},create:function(t){var e=t.formData;return n.l.post("/admin/categories",e,{headers:{Authorization:"Bearer ".concat(a())}})},update:function(t){var e=t.categoryId,r=t.formData;return n.l.put("/admin/categories/".concat(e),r,{headers:{Authorization:"Bearer ".concat(a())}})},delete:function(t){var e=t.categoryId;return n.l["delete"]("/admin/categories/".concat(e),{headers:{Authorization:"Bearer ".concat(a())}})}},restaurants:{get:function(){return n.l.get("admin/restaurants",{headers:{Authorization:"Bearer ".concat(a())}})},create:function(t){var e=t.formData;return n.l.post("/admin/restaurants",e,{headers:{Authorization:"Bearer ".concat(a())}})},delete:function(t){var e=t.restaurantId;return n.l["delete"]("/admin/restaurants/".concat(e),{headers:{Authorization:"Bearer ".concat(a())}})},getDetail:function(t){var e=t.restaurantId;return n.l.get("/admin/restaurants/".concat(e),{headers:{Authorization:"Bearer ".concat(a())}})},update:function(t){var e=t.restaurantId,r=t.formData;return n.l.put("/admin/restaurants/".concat(e),r,{headers:{Authorization:"Bearer ".concat(a())}})}},users:{get:function(){return n.l.get("/admin/users",{headers:{Authorization:"Bearer ".concat(a())}})},update:function(t){var e=t.userId,r=t.isAdmin;return n.l.put("/admin/users/".concat(e),{isAdmin:r},{headers:{Authorization:"Bearer ".concat(a())}})}}}}}]);
//# sourceMappingURL=713-legacy.194bb83e.js.map